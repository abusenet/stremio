import type { User } from "$lib/db.ts";

interface Props {
  user?: User;
}

export default function (props: Props) {
  const { user } = props;

  function fullscreen() {
    return document.documentElement.requestFullscreen();
  }

  let userPanel;
  if (user) {
    userPanel = (
      <>
        <a href="/account" class="hover:underline">Account</a>
        <span> / </span>
        <a href="/account/logout" class="hover:underline">Log out</a>
      </>
    )
   } else {
    userPanel = (
      <>
        <a href="/account/login" class="hover:underline">Log in</a>
        <span> / </span>
        <a href="/account/register" class="hover:underline">Sign up</a>
      </>
    )
  }

  return (
    <nav class="flex gap-2">
      <button
        onClick={fullscreen}
        class="opacity-40 hover:opacity-100"
      >
        <svg viewBox="0 0 512 512" class="w-8 h-8 fill-current">
          <path
            d="M406.5 311.9000000000001v95.8h-95.8"
            style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
          >
          </path>
          <path
            d="M105.5 202.5v-95.8h95.8"
            style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
          >
          </path>
          <path
            d="M310.6999999999998 106.70000000000005h95.8v95.8"
            style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
          >
          </path>
          <path
            d="M201.30000000000018 407.70000000000005h-95.8v-95.8"
            style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
          >
          </path>
        </svg>
      </button>

      <button
        id="user-popover-toggle" popovertarget="user-popover"
        class="opacity-40 hover:opacity-100"
      >
        <svg viewBox="0 0 512 512" class="w-8 h-8 fill-current">
          <path
            d="M327.60000000000036 151.70000000000005c-3.2 43.1-35.9 78.3-71.7 78.3-35.9 0-68.6-35.1-71.7-78.3a71.98 71.98 0 0 1 16.72-52.36 71.941 71.941 0 0 1 48.8-25.29 71.984 71.984 0 0 1 52.42 16.54 71.954 71.954 0 0 1 25.46 48.71c0.4 4.12 0.4 8.28 0 12.4Z"
            style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 37; fill: none;"
          >
          </path>
          <path
            d="M256 282.20000000000005c-70.9 0-142.9 39.1-156.2 113-0.5 1.73-0.66 3.54-0.45 5.32 0.2 1.79 0.75 3.52 1.63 5.09a13.584 13.584 0 0 0 8.22 6.49c1.11 0.32 2.25 0.49 3.4 0.5h287c2.71-0.07 5.34-0.95 7.55-2.52a13.59 13.59 0 0 0 4.87-6.3c1.03-2.78 1.16-5.82 0.38-8.68-13.4-73.8-85.5-112.9-156.4-112.9Z"
            style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 37; fill: none;"
          >
          </path>
        </svg>
      </button>

      <dialog
        id="user-popover"
        popover anchor="user-popover-toggle"
        class="
          right-[anchor(left)] top-[anchor(bottom)]
          text-white/90 bg-[#0f0d20]
          rounded-xl shadow
        "
      >
        <div class="flex justify-start items-center gap-x-4 py-6 px-4 border-b border-white/5">
          <img
            src="https://web.stremio.com/a2c10e5d14a94d1a7941218441cf6f8b176c6522/images/anonymous.png"
            alt=""
            width="60" height="60"
            class="bg-white/90 rounded-full"
          />

          <p class="">
            <span class="block">{user ? user.username : "Anonymous user"}</span>
            {userPanel}
          </p>
        </div>

        <a onClick={fullscreen} class="flex gap-2 items-center px-6 py-4 cursor-pointer border-b border-white/5">
          <svg viewBox="0 0 512 512" class="w-8 h-8 opacity-30 fill-current">
            <path
              d="M406.5 311.9000000000001v95.8h-95.8"
              style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
            >
            </path>
            <path
              d="M105.5 202.5v-95.8h95.8"
              style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
            >
            </path>
            <path
              d="M310.6999999999998 106.70000000000005h95.8v95.8"
              style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
            >
            </path>
            <path
              d="M201.30000000000018 407.70000000000005h-95.8v-95.8"
              style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 39.027; fill: none;"
            >
            </path>
          </svg>
          Enter fullscreen mode
        </a>

        <ul>
          <li>
            <a href="/settings" class="flex gap-2 items-center px-6 py-4 cursor-pointer">
              <svg viewBox="0 0 512 512" class="w-8 h-8 opacity-30 fill-current">
                <path d="M464 250a9.996 9.996 0 0 0-2.9-6.7 10.795 10.795 0 0 0-6.5-3.3l-25.6-4.2a5.867 5.867 0 0 1-3-1.6 5.693 5.693 0 0 1-1.5-3.1c-0.5-3.2-1-6.4-1.7-9.5a5.36 5.36 0 0 1 0.4-3.3 6.633 6.633 0 0 1 2.2-2.5l22.8-12.7c2.26-1.16 4.01-3.12 4.9-5.5 0.93-2.37 0.97-5 0.1-7.4l-3.9-10.9a10.6 10.6 0 0 0-4.8-5.6 10.285 10.285 0 0 0-7.3-0.9l-25.5 5c-1.16 0.18-2.34 0.01-3.4-0.5a5.34 5.34 0 0 1-2.4-2.3c-1.5-2.8-3.1-5.6-4.8-8.4-0.6-0.99-0.88-2.14-0.8-3.3 0.07-1.18 0.53-2.3 1.3-3.2l17-19.6c1.69-1.87 2.68-4.28 2.8-6.8 0.08-2.52-0.78-4.97-2.4-6.9l-7.4-8.9a10.298 10.298 0 0 0-13.6-2l-22.4 13.4c-1 0.58-2.15 0.83-3.3 0.7a5.24 5.24 0 0 1-3.1-1.4c-2.5-2.2-5-4.3-7.4-6.2a5.428 5.428 0 0 1-1.9-2.8c-0.28-1.13-0.21-2.31 0.2-3.4l9.3-24.4c0.99-2.33 1.1-4.95 0.31-7.36s-2.43-4.45-4.61-5.74l-10.1-5.9a10.34 10.34 0 0 0-7.3-1.2 9.96 9.96 0 0 0-6.2 4l-16.4 20.5a5.24 5.24 0 0 1-2.5 1.9c-1.02 0.33-2.13 0.26-3.1-0.2-0.6-0.2-5.8-2.4-9.8-3.7a5.508 5.508 0 0 1-2.7-2 5.31 5.31 0 0 1-1-3.2l0.4-26.1c0.15-2.55-0.63-5.08-2.2-7.1-1.55-2.01-3.8-3.36-6.3-3.8l-11.4-2c-2.49-0.4-5.04 0.09-7.2 1.4a10.49 10.49 0 0 0-4.5 5.8l-8.5 24.8a5.12 5.12 0 0 1-2.1 2.7c-0.98 0.64-2.13 0.96-3.3 0.9h-9.8c-1.15 0.04-2.28-0.31-3.2-1-0.97-0.66-1.7-1.6-2.1-2.7l-8.5-24.7c-0.71-2.43-2.32-4.51-4.5-5.8-2.16-1.3-4.71-1.79-7.2-1.4l-11.5 2c-2.48 0.48-4.72 1.83-6.3 3.8a9.968 9.968 0 0 0-2.2 7l0.4 26.2c-0.01 1.19-0.4 2.34-1.1 3.3-0.73 0.91-1.7 1.61-2.8 2-2.3 0.9-7.3 2.8-9.5 3.6-2 0.7-4.2-0.1-5.9-2.1l-16.3-20a9.96 9.96 0 0 0-6.2-4c-2.49-0.5-5.07-0.11-7.3 1.1l-10.1 5.8c-2.23 1.29-3.9 3.35-4.7 5.8-0.82 2.43-0.68 5.08 0.4 7.4l9.2 24.3c0.43 1.09 0.47 2.29 0.1 3.4-0.28 1.1-0.91 2.09-1.8 2.8-2.4 2-4.9 4-7.4 6.2-0.85 0.78-1.93 1.27-3.09 1.4-1.15 0.13-2.31-0.12-3.31-0.7l-22.1-13.7a10.68 10.68 0 0 0-7.2-1.6c-2.51 0.36-4.79 1.64-6.4 3.6l-7.4 8.9a10.224 10.224 0 0 0-2.4 6.9c0.1 2.53 1.09 4.94 2.8 6.8l17.1 19.6c0.77 0.9 1.23 2.02 1.3 3.2a5.47 5.47 0 0 1-0.8 3.3c-1.7 2.7-3.3 5.6-4.8 8.4a5.793 5.793 0 0 1-2.5 2.4c-1.05 0.51-2.24 0.69-3.4 0.5l-25.5-4.9a10.21 10.21 0 0 0-7.31 0.91c-2.24 1.2-3.94 3.19-4.79 5.59l-4 10.9c-0.92 2.39-0.88 5.04 0.1 7.4 0.92 2.36 2.66 4.31 4.9 5.5l22.8 12.7c1.01 0.57 1.81 1.45 2.3 2.5 0.49 1.06 0.6 2.27 0.3 3.4l-0.2 1.3c-0.5 2.8-1 5.4-1.5 8.2a5.716 5.716 0 0 1-1.5 3c-0.81 0.84-1.86 1.4-3 1.6l-25.7 4.2c-2.51 0.3-4.82 1.51-6.5 3.4a10.22 10.22 0 0 0-2.6 6.9v11.6c-0.01 2.54 0.91 4.99 2.59 6.89 1.67 1.9 3.99 3.11 6.51 3.41l25.7 4.1c1.15 0.18 2.21 0.75 3 1.6 0.81 0.85 1.33 1.94 1.5 3.1 0.5 3.2 1 6.4 1.7 9.5 0.21 1.15 0.08 2.33-0.4 3.4a6.633 6.633 0 0 1-2.2 2.5l-22.8 12.7a10.203 10.203 0 0 0-4.9 5.5c-0.88 2.38-0.92 5-0.1 7.4l4 10.9a10.6 10.6 0 0 0 4.8 5.6c2.24 1.19 4.84 1.52 7.3 0.9l25.6-4.9c1.16-0.23 2.36-0.05 3.4 0.5 1.02 0.5 1.86 1.3 2.4 2.3 1.5 2.8 3.1 5.6 4.8 8.4 0.6 0.99 0.88 2.14 0.8 3.3a5.39 5.39 0 0 1-1.3 3.2l-17 19.6a10.312 10.312 0 0 0-0.5 13.8l7.4 8.9a10.298 10.298 0 0 0 13.6 2l22.4-13.4c1-0.58 2.15-0.83 3.3-0.7 1.16 0.11 2.25 0.6 3.1 1.4 2.5 2.2 5 4.3 7.4 6.2 0.92 0.71 1.58 1.69 1.9 2.8 0.32 1.12 0.28 2.3-0.1 3.4l-9.3 24.4c-0.99 2.33-1.1 4.95-0.31 7.36s2.43 4.45 4.61 5.74l10.1 5.8c2.2 1.29 4.8 1.71 7.3 1.2a9.96 9.96 0 0 0 6.2-4l16.6-20.3c1.4-1.7 3.6-2.5 5.2-1.8 3.5 1.4 5.8 2.2 9.9 3.6 1.09 0.37 2.03 1.07 2.7 2a5.31 5.31 0 0 1 1 3.2l-0.4 26.1a11.3 11.3 0 0 0 2.2 7.1c1.55 2.01 3.8 3.36 6.3 3.8l11.4 2c2.49 0.41 5.04-0.09 7.2-1.4 2.18-1.29 3.79-3.37 4.5-5.8l8.5-24.8a5.12 5.12 0 0 1 2.1-2.7c0.95-0.69 2.13-1.01 3.3-0.9h9.8c1.15-0.04 2.28 0.32 3.2 1 0.97 0.66 1.7 1.6 2.1 2.7l8.5 24.7a10.662 10.662 0 0 0 10 7.4c0.6-0.02 1.21-0.08 1.8-0.2l11.5-2c2.49-0.47 4.72-1.82 6.3-3.8a9.968 9.968 0 0 0 2.2-7l-0.4-26.2c-0.04-1.15 0.31-2.28 1-3.2 0.69-0.91 1.63-1.6 2.7-2 3.8-1.3 6.5-2.3 8.9-3.2l0.6-0.2c3.1-1.1 4.6 0.2 5.5 1.3l16.8 20.6a10.278 10.278 0 0 0 13.5 2.8l10.1-5.8a9.948 9.948 0 0 0 4.6-5.7c0.8-2.42 0.7-5.05-0.3-7.4l-9.2-24.3a5.724 5.724 0 0 1-0.2-3.4 4.88 4.88 0 0 1 1.9-2.8c2.4-2 4.9-4 7.4-6.2 0.87-0.76 1.95-1.25 3.1-1.4 1.15-0.12 2.3 0.13 3.3 0.7l22.4 13.4a10.68 10.68 0 0 0 7.2 1.6c2.51-0.36 4.79-1.64 6.4-3.6l7.4-8.9c1.64-1.95 2.5-4.45 2.4-7-0.1-2.53-1.09-4.94-2.8-6.8l-17.1-19.7c-0.76-0.89-1.21-2-1.3-3.17-0.09-1.17 0.19-2.33 0.8-3.33 1.7-2.7 3.3-5.6 4.8-8.4a6.48 6.48 0 0 1 2.5-2.4c1.05-0.51 2.24-0.69 3.4-0.5l25.5 5c2.46 0.62 5.07 0.3 7.31-0.9 2.24-1.2 3.95-3.2 4.79-5.6l3.9-10.9c0.92-2.39 0.88-5.04-0.1-7.4-0.92-2.36-2.66-4.31-4.9-5.5l-22.8-12.7a5.568 5.568 0 0 1-2.3-2.5c-0.5-1.06-0.6-2.27-0.3-3.4l0.2-1.3c0.5-2.8 1-5.4 1.5-8.2 0.19-1.13 0.71-2.17 1.5-3 0.81-0.84 1.86-1.4 3-1.6l25.7-4.1c2.51-0.3 4.82-1.51 6.5-3.4 1.69-1.9 2.62-4.36 2.6-6.9v-11.8h-0.1Zm-282.4 94a15.52 15.52 0 0 1-5.1 5.4c-2.1 1.37-4.5 2.23-7 2.5-2.48 0.27-4.99-0.07-7.3-1-2.34-0.9-4.43-2.34-6.1-4.2a135.028 135.028 0 0 1-34.9-90.88 135.02 135.02 0 0 1 35.3-90.72c1.67-1.86 3.76-3.3 6.1-4.2 2.32-0.89 4.83-1.2 7.3-0.9 2.5 0.27 4.9 1.13 7 2.5a16.56 16.56 0 0 1 5.1 5.4l45.6 80.4c1.38 2.41 2.1 5.13 2.1 7.9 0 2.77-0.72 5.49-2.1 7.9l-46 79.9Zm74.4 47.2c-9.51 0-19-1-28.3-3-2.43-0.52-4.7-1.62-6.61-3.21-1.91-1.58-3.42-3.6-4.39-5.89-0.97-2.27-1.41-4.73-1.3-7.2 0.13-2.47 0.85-4.87 2.1-7l46-80c1.4-2.4 3.4-4.4 5.8-5.8 2.4-1.39 5.13-2.12 7.9-2.1h92.1c2.47 0.01 4.9 0.59 7.1 1.7a15.9 15.9 0 0 1 5.6 4.7c1.47 2.02 2.46 4.34 2.9 6.8 0.39 2.44 0.22 4.94-0.5 7.3-17.5 54.2-68.4 93.7-128.4 93.7Zm7.5-163.9L218 147.0999999999999a17.248 17.248 0 0 1-2.1-7c-0.21-3.72 0.91-7.4 3.16-10.37 2.26-2.97 5.5-5.04 9.14-5.83 9.11-1.91 18.39-2.89 27.7-2.9 60 0 110.9 39.4 128.4 93.8 0.71 2.37 0.88 4.86 0.5 7.3-0.41 2.45-1.4 4.77-2.88 6.77-1.47 1.99-3.4 3.62-5.62 4.73-2.21 1.1-4.63 1.68-7.1 1.7h-92c-2.8 0-5.56-0.72-8-2.1-2.33-1.5-4.28-3.52-5.7-5.9Z"></path>
              </svg>
              <span>Settings</span>
            </a>
          </li>
          <li>
            <a href="/addons" class="flex gap-2 items-center px-6 py-4 cursor-pointer">
              <svg viewBox="0 0 512 512" class="w-8 h-8 opacity-30 fill-current">
                <path d="M413.6999999999998 246.10000000000014H386c-0.53-0.01-1.03-0.23-1.4-0.6-0.37-0.37-0.59-0.87-0.6-1.4v-77.2a38.94 38.94 0 0 0-11.4-27.5 38.94 38.94 0 0 0-27.5-11.4h-77.2c-0.53-0.01-1.03-0.23-1.4-0.6-0.37-0.37-0.59-0.87-0.6-1.4v-27.7c0-27.1-21.5-49.9-48.6-50.3-6.57-0.1-13.09 1.09-19.2 3.5a49.616 49.616 0 0 0-16.4 10.7 49.823 49.823 0 0 0-11 16.2 48.894 48.894 0 0 0-3.9 19.2v28.5c-0.01 0.53-0.23 1.03-0.6 1.4-0.37 0.37-0.87 0.59-1.4 0.6h-77.2c-10.5 0-20.57 4.17-28 11.6a39.594 39.594 0 0 0-11.6 28v70.4c0.01 0.53 0.23 1.03 0.6 1.4 0.37 0.37 0.87 0.59 1.4 0.6h26.9c29.4 0 53.7 25.5 54.1 54.8 0.4 29.9-23.5 57.2-53.3 57.2H50c-0.53 0.01-1.03 0.23-1.4 0.6-0.37 0.37-0.59 0.87-0.6 1.4v70.4c0 10.5 4.17 20.57 11.6 28s17.5 11.6 28 11.6h70.4c0.53-0.01 1.03-0.23 1.4-0.6 0.37-0.37 0.59-0.87 0.6-1.4V441.20000000000005c0-30.3 24.8-56.4 55-57.1 30.1-0.7 57 20.3 57 50.3v27.7c0.01 0.53 0.23 1.03 0.6 1.4 0.37 0.37 0.87 0.59 1.4 0.6h71.1a38.94 38.94 0 0 0 27.5-11.4 38.958 38.958 0 0 0 11.4-27.5v-78c0.01-0.53 0.23-1.03 0.6-1.4 0.37-0.37 0.87-0.59 1.4-0.6h28.5c27.6 0 49.5-22.7 49.5-50.4s-23.2-48.7-50.3-48.7Z" style="stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32; fill: none;"></path>
              </svg>
              <span>Addons</span>
            </a>
          </li>
        </ul>
      </dialog>
    </nav>
  );
}
